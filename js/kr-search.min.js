(()=>{(()=>{let I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},O=n=>n.replace(/[&<>"'/]/g,s=>I[s]),A={"{":"\\{","}":"\\}","[":"\\[","]":"\\]","(":"\\(",")":"\\)","?":"\\?","*":"\\*",".":"\\.","+":"\\+","^":"\\^",$:"\\$"},E=n=>n.replace(/[\{\}\[\]\(\)\?\*\.\+\^\$]/g,s=>A[s]),L=n=>{n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let c=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(window.location);return c===null?"":decodeURIComponent(c[1].replace(/\+/g," "))},u=(n,s)=>{let c=document.getElementById("kr-search-notice");c.className="alert alert-"+n,c.innerText=s},$=()=>{document.getElementById("kr-search-results").innerHTML=""},N=n=>{let s="",c=document.getElementById("kr-search-result-template").innerHTML,y=document.getElementById("kr-search-tag-begin-template").innerHTML,g=document.getElementById("kr-search-tag-template").innerHTML,f=document.getElementById("kr-search-category-template").innerHTML;for(let p of n){let t=p[0],l=[];for(let o of t.tags)l.push(g.replaceAll("$LINK",o[1]).replaceAll("$TAG",o[0]));s+=c.replaceAll("$CATEGORY",t.category[0]!=="undefined"?f.replaceAll("$LINK",t.category[1]).replaceAll("$CATEGORY",t.category[0]):"").replaceAll("$LINK",t.link).replaceAll("$TITLE",t.title).replaceAll("$CONTENT",t.content).replaceAll("$DATE",t.date).replaceAll("$TAGS",l.length!==0?y+l.join(", "):"")}document.getElementById("kr-search-results").innerHTML=s},k=(n,s)=>{fetch(n).then(c=>(u("success","\u6587\u4EF6\u52A0\u8F7D\u5B8C\u6210\uFF0C\u5F00\u59CB\u641C\u7D22\u5566~"),typeof NProgress<"u"&&NProgress.inc(),c.json())).then(c=>{let y=performance.now(),g=[],f=0,p=s.trim().toLowerCase().split(/\s/);if(c.forEach(t=>{if(typeof t.title>"u"||typeof t.content>"u")return;let l=!1,o=t.title.trim().toLowerCase(),d=t.content?t.content.trim().replace(/<[^>]+>/g,"").toLowerCase():"",T=0,e={};e.title=-1,e.content=-1,e.firstOccur=-1,e.lastOccur=-1;let m=100;if(o&&p.forEach(r=>{e.title=o.indexOf(r),e.content=d.indexOf(r),(e.title!==-1||e.content!==-1)&&(l=!0,e.content!==-1?((e.firstOccur>e.content||e.firstOccur===-1)&&(e.firstOccur=e.content),e.lastOccur<e.content&&(e.lastOccur=e.content)):(e.firstOccur=m,e.lastOccur=0),T+=e.title!==-1?2:0,T+=e.content!==-1?1:0,f++)}),l){let r={};if(r.title=t.title,r.date=new Date(t.date).toLocaleDateString(),r.tags=t.tags||[],r.category=t.categories[0]||[],r.link=t.url,p.forEach(a=>{let i=new RegExp(E(a)+"(?!>)","gi");r.title=r.title.replace(i,"<m>$&</m>")}),e.firstOccur>=0){let a=e.firstOccur-m,i=e.lastOccur+m;a<0&&(a=0),a===0&&(i=m*2),i>d.length&&(i=d.length),r.content=d.substr(a,i-a),p.forEach(C=>{let S=new RegExp(E(C)+"(?!>)","gi");r.content=r.content.replace(S,"<m>$&</m>")})}g.push([r,T])}}),f!==0){let t=performance.now();u("success","\u627E\u5230 "+f+" \u6761\u641C\u7D22\u7ED3\u679C\uFF0C\u7528\u65F6 "+Math.round((t-y)*100)/100+" \u6BEB\u79D2~"),g.sort((l,o)=>o[1]-l[1]),N(g)}else u("danger","\u4EC0\u4E48\u90FD\u6CA1\u6709\u627E\u5230\u6B38..."),$();typeof NProgress<"u"&&NProgress.done()}).catch(c=>{u("danger","\u9519\u8BEF : "+c)})},w=n=>{u("info","\u6B63\u5728\u52A0\u8F7D\u641C\u7D22\u6587\u4EF6..."),typeof NProgress<"u"&&NProgress.start(),k(window.searchDataFile,O(n))},B=()=>{let n=document.getElementById("search-input").value;return window.history.pushState({},0,window.location.href.split("?")[0]+"?s="+n.replace(/\s/g,"+")),w(n),!1},h=L("s");h!==""&&(document.getElementById("search-input").value=h,w(h)),window.inpSearch=B})();})();
